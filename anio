import pandas as pd
import os

ruta_csv = r'C:\Users\pasante.ti2\Desktop\bases prepago\base_prepago_limpia.csv'
carpeta_salida = r'C:\Users\pasante.ti2\Desktop\bases prepago\por_anio'
os.makedirs(carpeta_salida, exist_ok=True)

# Leer CSV por partes
chunks = pd.read_csv(ruta_csv, encoding='latin1', chunksize=500000)  # Ajusta según memoria
df_list = []

for chunk in chunks:
    # Normalizar columna año
    if 'anio' not in chunk.columns:
        for col in chunk.columns:
            if 'anio' in col.lower() or 'año' in col.lower():
                chunk = chunk.rename(columns={col: 'anio'})
                break
    chunk['anio'] = chunk['anio'].astype(str).str.strip()
    df_list.append(chunk[chunk['anio'] == '2023'])

# Concatenar todas las partes
df_2023 = pd.concat(df_list, ignore_index=True)

# Exportar CSV
archivo_salida = os.path.join(carpeta_salida, 'base_prepago_2023.csv')
df_2023.to_csv(archivo_salida, index=False, encoding='latin1')
print(f"✅ Exportado: {archivo_salida} ({len(df_2023)} filas)")
